<?xml version="1.0" encoding="UTF-8"?>
<!-- DOCTYPE이 sqlMap인 xml 파일은 처리할 SQL 명령을 기억하는 xml 파일이다. -->
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<!--
    태그를 이용해서 저장하고 출력하는 내용들을 한다
-->

<!--
    id: SQL 명령 식별
    parameterClass: SQL 명령으로 DAO 클래스에서 전달되는 데이터 타입을 적는다
    resultClass: SQL 명령문이 실행되고 DAO 클래스로 리턴되는 데이터의 타입을 적는다
-->
<sqlMap namespace="com.kh.vo.GuestbookVO">
  <insert id="insert" parameterClass="vo">INSERT INTO guestbook(idx, name,
    password, memo, ip) values (guestbook_idx_seq.nextval, #name#, #password#, #memo#, #ip#)</insert>
    
  <!-- 전체 글의 개수를 얻어온다 -->
  <select id="selectCount" resultClass="int">
    SELECT COUNT(*) FROM guestbook
  </select>
  
  <!-- 페이지의 글 목록을 얻어온다 -->
  <select id="selectList" parameterClass="java.util.HashMap" resultClass="vo">
    <!--
      startNo: 페이지 표시할 글의 시작 인덱스
      endNo: 페이지에 표시할 글의 마지막 인덱스
     -->
    <!--
     SQL문을 XML 파일 안에서 작성할 때 SQL의 특수 기호들이
     XML 파일에서 특정한 문자나 특수한 행동을 발생시킬 수 있음
     모든 내용을 문자열로 인식할 수 있게 <![CDATA[ ]]> 내용을 적음
    -->
    <![CDATA[
      select * from (
        select rownum rnum, TT.* from (
          select * from guestbook order by idx desc
        ) TT where rownum <= #endNo#
      ) where rnum >= #startNo#
    ]]>
  </select>
</sqlMap>
